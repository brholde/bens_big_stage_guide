const stageLayouts = {
  "8": {
    "8": [
      [
        "3"
      ]
    ],
    "12": [
      [
        "8"
      ]
    ],
    "16": [
      [
        "3",
        "3"
      ]
    ],
    "20": [
      [
        "6",
        "0",
        "6"
      ]
    ],
    "24": [
      [
        "3",
        "1",
        "3"
      ]
    ],
    "28": [
      [
        "8",
        "0",
        "8"
      ]
    ],
    "32": [
      [
        "6",
        "0",
        "6",
        "0",
        "6"
      ]
    ],
    "36": [
      [
        "6",
        "0",
        "8",
        "0",
        "6"
      ]
    ],
    "40": [
      [
        "3",
        "1",
        "3",
        "1",
        "3"
      ]
    ],
    "44": [
      [
        "8",
        "0",
        "8",
        "0",
        "8"
      ]
    ],
    "48": [
      [
        "8",
        "0",
        "6",
        "0",
        "6",
        "0",
        "6"
      ]
    ],
    "52": [
      [
        "6",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6"
      ]
    ],
    "56": [
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6"
      ]
    ],
    "60": [
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8"
      ]
    ],
    "64": [
      [
        "8",
        "0",
        "6",
        "0",
        "6",
        "0",
        "6",
        "0",
        "8"
      ]
    ],
    "68": [
      [
        "6",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6"
      ]
    ],
    "72": [
      [
        "8",
        "0",
        "8",
        "0",
        "6",
        "0",
        "8",
        "0",
        "8"
      ]
    ],
    "76": [
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8"
      ]
    ],
    "80": [
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6",
        "0",
        "6",
        "0",
        "6"
      ]
    ],
    "84": [
      [
        "6",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6"
      ]
    ],
    "88": [
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6"
      ]
    ],
    "92": [
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8"
      ]
    ],
    "96": [
      [
        "8",
        "0",
        "8",
        "0",
        "6",
        "0",
        "6",
        "0",
        "6",
        "0",
        "8",
        "0",
        "8"
      ]
    ],
    "100": [
      [
        "6",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6"
      ]
    ],
    "104": [
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8"
      ]
    ],
    "108": [
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "6",
        "0",
        "6",
        "0",
        "6"
      ]
    ],
    "112": [
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6",
        "0",
        "6",
        "0",
        "6"
      ]
    ],
    "116": [
      [
        "6",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6"
      ]
    ],
    "120": [
      [
        "6",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "6"
      ]
    ],
    "124": [
      [
        "6",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "6"
      ]
    ],
    "128": [
      [
        "6",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6",
        "0",
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6"
      ]
    ]
  },
  "12": {
    "16": [
      [
        "4",
        "4"
      ]
    ],
    "24": [
      [
        "4",
        "7",
        "4"
      ]
    ],
    "32": [
      [
        "4",
        "7",
        "4",
        "4"
      ]
    ],
    "40": [
      [
        "4",
        "7",
        "4",
        "7",
        "4"
      ]
    ],
    "48": [
      [
        "4",
        "7",
        "4",
        "4",
        "7",
        "4"
      ]
    ],
    "56": [
      [
        "4",
        "7",
        "4",
        "7",
        "4",
        "7",
        "4"
      ]
    ],
    "64": [
      [
        "4",
        "7",
        "4",
        "7",
        "4",
        "7",
        "4",
        "4"
      ]
    ],
    "72": [
      [
        "4",
        "7",
        "4",
        "7",
        "4",
        "7",
        "4",
        "7",
        "4"
      ]
    ],
    "80": [
      [
        "4",
        "7",
        "4",
        "7",
        "4",
        "4",
        "7",
        "4",
        "7",
        "4"
      ]
    ],
    "88": [
      [
        "4",
        "7",
        "4",
        "7",
        "4",
        "7",
        "4",
        "7",
        "4",
        "7",
        "4"
      ]
    ]
  },
  "16": {
    "20": [
      [
        "6",
        "0",
        "6"
      ],
      [
        "8",
        "6"
      ]
    ],
    "24": [
      [
        "8",
        "0",
        "6"
      ],
      [
        "8",
        "0",
        "6"
      ]
    ],
    "28": [
      [
        "8",
        "0",
        "8"
      ],
      [
        "8",
        "0",
        "8"
      ]
    ],
    "32": [
      [
        "8",
        "6",
        "0",
        "6"
      ],
      [
        "8",
        "8",
        "6"
      ]
    ],
    "36": [
      [
        "8",
        "0",
        "6",
        "0",
        "6"
      ],
      [
        "8",
        "0",
        "8",
        "6"
      ]
    ],
    "40": [
      [
        "8",
        "0",
        "6",
        "0",
        "8"
      ],
      [
        "8",
        "0",
        "6",
        "0",
        "8"
      ]
    ],
    "44": [
      [
        "8",
        "0",
        "8",
        "0",
        "8"
      ],
      [
        "8",
        "0",
        "8",
        "0",
        "8"
      ]
    ],
    "48": [
      [
        "8",
        "0",
        "8",
        "0",
        "6",
        "6"
      ],
      [
        "8",
        "0",
        "8",
        "8",
        "6"
      ]
    ],
    "52": [
      [
        "8",
        "0",
        "8",
        "0",
        "6",
        "0",
        "6"
      ],
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "6"
      ]
    ],
    "56": [
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6"
      ],
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6"
      ]
    ]
  },
  "20": {
    "24": [
      [
        "4",
        "7",
        "4"
      ],
      [
        "3",
        "1",
        "3"
      ]
    ],
    "32": [
      [
        "4",
        "7",
        "4",
        "4"
      ],
      [
        "3",
        "1",
        "3",
        "3"
      ]
    ],
    "40": [
      [
        "4",
        "7",
        "4",
        "7",
        "4"
      ],
      [
        "3",
        "1",
        "3",
        "1",
        "3"
      ]
    ],
    "48": [
      [
        "4",
        "7",
        "4",
        "4",
        "7",
        "4"
      ],
      [
        "8",
        "0",
        "6",
        "6",
        "0",
        "8"
      ]
    ],
    "56": [
      [
        "4",
        "7",
        "4",
        "7",
        "4",
        "7",
        "4"
      ],
      [
        "8",
        "6",
        "0",
        "6",
        "0",
        "6",
        "8"
      ]
    ]
  },
  "24": {
    "24": [
      [
        "4",
        "7",
        "4"
      ],
      [
        "5",
        "5",
        "5"
      ],
      [
        "3",
        "1",
        "3"
      ]
    ],
    "28": [
      [
        "8",
        "0",
        "8"
      ],
      [
        "9",
        "0",
        "9"
      ],
      [
        "8",
        "0",
        "8"
      ]
    ],
    "32": [
      [
        "4",
        "7",
        "4",
        "4"
      ],
      [
        "5",
        "5",
        "5",
        "5"
      ],
      [
        "3",
        "1",
        "3",
        "3"
      ]
    ],
    "36": [
      [
        "8",
        "0",
        "8",
        "6"
      ],
      [
        "9",
        "0",
        "9",
        "2"
      ],
      [
        "8",
        "0",
        "8",
        "6"
      ]
    ],
    "40": [
      [
        "4",
        "7",
        "4",
        "7",
        "4"
      ],
      [
        "5",
        "5",
        "5",
        "5",
        "5"
      ],
      [
        "3",
        "1",
        "3",
        "1",
        "3"
      ]
    ],
    "44": [
      [
        "8",
        "0",
        "8",
        "0",
        "8"
      ],
      [
        "9",
        "0",
        "9",
        "0",
        "9"
      ],
      [
        "8",
        "0",
        "8",
        "0",
        "8"
      ]
    ],
    "48": [
      [
        "8",
        "8",
        "0",
        "8",
        "6"
      ],
      [
        "9",
        "9",
        "0",
        "9",
        "2"
      ],
      [
        "8",
        "8",
        "0",
        "8",
        "6"
      ]
    ],
    "52": [
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "6"
      ],
      [
        "9",
        "0",
        "9",
        "0",
        "9",
        "2"
      ],
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "6"
      ]
    ],
    "56": [
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6"
      ],
      [
        "9",
        "0",
        "9",
        "0",
        "9",
        "0",
        "2"
      ],
      [
        "8",
        "0",
        "8",
        "0",
        "8",
        "0",
        "6"
      ]
    ]
  },
  "28": {
    "32": [
      [
        "4",
        "7",
        "4",
        "4"
      ],
      [
        "5",
        "5",
        "5",
        "5"
      ],
      [
        "4",
        "7",
        "4",
        "4"
      ]
    ],
    "40": [
      [
        "4",
        "7",
        "4",
        "7",
        "4"
      ],
      [
        "5",
        "5",
        "5",
        "5",
        "5"
      ],
      [
        "4",
        "7",
        "4",
        "7",
        "4"
      ]
    ]
  },
  "32": {
    "32": [
      [
        "8",
        "8",
        "6"
      ],
      [
        "9",
        "9",
        "2"
      ],
      [
        "8",
        "8",
        "6"
      ],
      [
        "8",
        "8",
        "6"
      ]
    ],
    "36": [
      [
        "8",
        "0",
        "8",
        "6"
      ],
      [
        "9",
        "0",
        "9",
        "2"
      ],
      [
        "8",
        "0",
        "8",
        "6"
      ],
      [
        "8",
        "0",
        "8",
        "6"
      ]
    ],
    "40": [
      [
        "8",
        "0",
        "8",
        "0",
        "6"
      ],
      [
        "9",
        "0",
        "9",
        "0",
        "2"
      ],
      [
        "8",
        "0",
        "8",
        "0",
        "6"
      ],
      [
        "8",
        "0",
        "8",
        "0",
        "6"
      ]
    ]
  },
  "36": {
    "40": [
      [
        "4",
        "7",
        "4",
        "7",
        "4"
      ],
      [
        "5",
        "5",
        "5",
        "5",
        "5"
      ],
      [
        "4",
        "7",
        "4",
        "7",
        "4"
      ],
      [
        "3",
        "1",
        "3",
        "1",
        "3"
      ]
    ]
  },
  "40": {
    "40": [
      [
        "4",
        "7",
        "4",
        "7",
        "4"
      ],
      [
        "5",
        "5",
        "5",
        "5",
        "5"
      ],
      [
        "3",
        "1",
        "3",
        "1",
        "3"
      ],
      [
        "5",
        "5",
        "5",
        "5",
        "5"
      ],
      [
        "4",
        "7",
        "4",
        "7",
        "4"
      ]
    ]
  }
};

function findClosestMatch(inputWidth, inputLength) {
    let closest = null;
    let minDiff = Infinity;

    for (const w in stageLayouts) {
        for (const l in stageLayouts[w]) {
            const width = parseInt(w);
            const length = parseInt(l);

            // Try both orientations against input
            const diff1 = Math.abs(width - inputWidth) + Math.abs(length - inputLength);
            const diff2 = Math.abs(length - inputWidth) + Math.abs(width - inputLength);
            const thisDiff = Math.min(diff1, diff2);

            if (thisDiff <= minDiff) {
                minDiff = thisDiff;
                closest = { width: w, length: l };
            }
        }
    }

    return closest;
}

function findLayout() {
    let possibleLayout = true;
    const lengthInput = parseInt(document.getElementById("length").value);
    const widthInput = parseInt(document.getElementById("width").value);
    const resultElement = document.getElementById("result");

    if (!lengthInput || !widthInput) {
        resultElement.textContent = "Enter valid dimensions.";
        return;
    }

    let layout = stageLayouts[widthInput]?.[lengthInput] || stageLayouts[lengthInput]?.[widthInput];
    let usedWidth = widthInput;
    let usedLength = lengthInput;

    if (!layout) {
        possibleLayout = false;
        const closest = findClosestMatch(widthInput, lengthInput);
        if (!closest) {
            resultElement.textContent = "No layout found for that size.";
            return;
        }
        usedWidth = parseInt(closest.width);
        usedLength = parseInt(closest.length);
        layout = stageLayouts[closest.width][closest.length];
    }

    // Estimate grid size in pixels (rough guess: assume 200px natural max size per image)
    const rows = layout.length;
    const cols = Math.max(...layout.map(row => row.length));
    const maxImageSize = 300;

    const totalWidth = cols * maxImageSize;
    const totalHeight = rows * maxImageSize;

    // Get available space (container width)
    const containerWidth = document.querySelector('.container').clientWidth;
    const scaleX = containerWidth / totalWidth;
    const maxScale = Math.min(scaleX, 1);  // Never scale up, only down

    // Create the layout grid
    const grid = document.createElement("div");
    grid.className = "layout-grid";
    grid.style.setProperty('--scale', maxScale);

    layout.forEach(row => {
        const rowDiv = document.createElement("div");
        rowDiv.className = "layout-row";

        row.forEach(cell => {
            const wrapper = document.createElement("div");
            wrapper.className = "layout-image-wrapper";

            const img = document.createElement("img");
            img.src = `images/${cell}.png`;
            img.alt = cell;
            img.className = "layout-image";

            wrapper.appendChild(img);
            rowDiv.appendChild(wrapper);
        });

        grid.appendChild(rowDiv);
    });



    resultElement.innerHTML = `
        <div id="dimension-label" style="margin-bottom: 10px; margin-top: 50px; font-weight: bold;">
            Layout for: ${usedLength} ft x ${usedWidth} ft
        </div>
    `;
    resultElement.appendChild(grid);

    if (!possibleLayout) {
        document.getElementById("dimension-label").style.color = "red";
        document.getElementById("dimension-label").innerText = `Could not find an exact match, showing results instead for ${usedLength} ft x ${usedWidth} ft`;
    } else {
        document.getElementById("dimension-label").style.color = "green";
    }
}

function debounce(func, delay) {
    let timeout;
    return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), delay);
    };
}

const debouncedFindLayout = debounce(findLayout, 200);

document.getElementById("length").addEventListener("input", debouncedFindLayout);
document.getElementById("width").addEventListener("input", debouncedFindLayout);

findLayout(document.getElementById("length").value, document.getElementById("width").value); // Initial call to populate result on page load